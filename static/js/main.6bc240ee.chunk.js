(this["webpackJsonpit-incubator-todolist-ts"]=this["webpackJsonpit-incubator-todolist-ts"]||[]).push([[0],{103:function(e,t,a){},104:function(e,t,a){},127:function(e,t,a){"use strict";a.r(t);var s={};a.r(s),a.d(s,"selectIsLoggedIn",(function(){return ee}));var o=a(0),l=a.n(o),d=a(8),i=a.n(d);a(103);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(104);var r=a(169),n=a(170),c=a(171),u=a(166),p=a(172),m=a(173),g=a(78);const f=a.n(g).a.create({baseURL:"https://social-network.samuraijs.com/api/1.1/",withCredentials:!0,headers:{"API-KEY":"87fb7732-33cb-44fa-a33f-93280547d337"}}),h={getTodolists:()=>f.get("todo-lists"),createTodolist:e=>f.post("todo-lists",{title:e}),deleteTodolist:e=>f.delete("todo-lists/".concat(e)),updateTodolist:(e,t)=>f.put("todo-lists/".concat(e),{title:t}),getTasks:e=>f.get("todo-lists/".concat(e,"/tasks")),deleteTask:(e,t)=>f.delete("todo-lists/".concat(e,"/tasks/").concat(t)),createTask:(e,t)=>f.post("todo-lists/".concat(e,"/tasks"),{title:t}),updateTask:(e,t,a)=>f.put("todo-lists/".concat(e,"/tasks/").concat(t),a)},E={login:e=>f.post("auth/login",e),logout:()=>f.delete("auth/login"),me:()=>f.get("auth/me")};var y=a(11);const b={setAppStatus:Object(y.b)("appActions/setAppStatus"),setAppError:Object(y.b)("appActions/setAppError")},k=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return a&&t.dispatch(b.setAppError({error:e.messages.length?e.messages[0]:"Some error occurred"})),t.dispatch(b.setAppStatus({status:"failed"})),t.rejectWithValue({errors:e.messages,fieldsErrors:e.fieldsErrors})},v=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return a&&t.dispatch(b.setAppError({error:e.message?e.message:"Some error occurred"})),t.dispatch(b.setAppStatus({status:"failed"})),t.rejectWithValue({errors:[e.message],fieldsErrors:void 0})},{setAppStatus:T}=b,C=Object(y.c)("todolists/fetchTodolists",async(e,t)=>{t.dispatch(T({status:"loading"}));try{const e=await h.getTodolists();return t.dispatch(T({status:"succeeded"})),{todolists:e.data}}catch(a){return v(a,t)}}),I=Object(y.c)("todolists/removeTodolist",async(e,t)=>{let{dispatch:a,rejectWithValue:s}=t;a(T({status:"loading"})),a(A({id:e,status:"loading"}));await h.deleteTodolist(e);return a(T({status:"succeeded"})),{id:e}}),j=Object(y.c)("todolists/addTodolist",async(e,t)=>{t.dispatch(T({status:"loading"}));try{const a=await h.createTodolist(e);return 0===a.data.resultCode?(t.dispatch(T({status:"succeeded"})),{todolist:a.data.data.item}):k(a.data,t,!1)}catch(a){return v(a,t,!1)}}),O=Object(y.c)("todolists/changeTodolistTitle",async(e,t)=>{try{const a=await h.updateTodolist(e.id,e.title);return 0===a.data.resultCode?(t.dispatch(T({status:"succeeded"})),{id:e.id,title:e.title}):k(a.data,t)}catch(a){return v(a,t,!1)}}),w={fetchTodolistsTC:C,removeTodolistTC:I,addTodolistTC:j,changeTodolistTitleTC:O},S=Object(y.d)({name:"todolists",initialState:[],reducers:{changeTodolistFilter(e,t){const a=e.findIndex(e=>e.id===t.payload.id);e[a].filter=t.payload.filter},changeTodolistEntityStatus(e,t){const a=e.findIndex(e=>e.id===t.payload.id);e[a].entityStatus=t.payload.status}},extraReducers:e=>{e.addCase(C.fulfilled,(e,t)=>t.payload.todolists.map(e=>({...e,filter:"all",entityStatus:"idle"}))).addCase(I.fulfilled,(e,t)=>{const a=e.findIndex(e=>e.id===t.payload.id);a>-1&&e.splice(a,1)}).addCase(j.fulfilled,(e,t)=>{e.unshift({...t.payload.todolist,filter:"all",entityStatus:"idle"})}).addCase(O.fulfilled,(e,t)=>{const a=e.findIndex(e=>e.id===t.payload.id);e[a].title=t.payload.title})}}),{changeTodolistFilter:x,changeTodolistEntityStatus:A}=S.actions,L=Object(y.c)("tasks/fetchTasks",async(e,t)=>{t.dispatch(b.setAppStatus({status:"loading"}));try{const a=(await h.getTasks(e)).data.items;return t.dispatch(b.setAppStatus({status:"succeeded"})),{tasks:a,todolistId:e}}catch(a){return v(a,t)}}),z=Object(y.c)("tasks/removeTask",async(e,t)=>{await h.deleteTask(e.todolistId,e.taskId);return{taskId:e.taskId,todolistId:e.todolistId}}),P=Object(y.c)("tasks/addTask",async(e,t)=>{t.dispatch(b.setAppStatus({status:"loading"}));try{const a=await h.createTask(e.todolistId,e.title);return 0===a.data.resultCode?(t.dispatch(b.setAppStatus({status:"succeeded"})),a.data.data.item):(k(a.data,t,!1),t.rejectWithValue({errors:a.data.messages,fieldsErrors:a.data.fieldsErrors}))}catch(a){return v(a,t,!1)}}),F=Object(y.c)("tasks/updateTask",async(e,t)=>{const a=t.getState().tasks[e.todolistId].find(t=>t.id===e.taskId);if(!a)return t.rejectWithValue("task not found in the state");const s={deadline:a.deadline,description:a.description,priority:a.priority,startDate:a.startDate,title:a.title,status:a.status,...e.model},o=await h.updateTask(e.todolistId,e.taskId,s);try{return 0===o.data.resultCode?e:k(o.data,t)}catch(l){return v(l,t)}}),N={fetchTasks:L,removeTask:z,addTask:P,updateTask:F},W=Object(y.d)({name:"tasks",initialState:{},reducers:{},extraReducers:e=>{e.addCase(w.addTodolistTC.fulfilled,(e,t)=>{e[t.payload.todolist.id]=[]}).addCase(w.removeTodolistTC.fulfilled,(e,t)=>{delete e[t.payload.id]}).addCase(w.fetchTodolistsTC.fulfilled,(e,t)=>{t.payload.todolists.forEach(t=>{e[t.id]=[]})}).addCase(L.fulfilled,(e,t)=>{e[t.payload.todolistId]=t.payload.tasks}).addCase(z.fulfilled,(e,t)=>{const a=e[t.payload.todolistId],s=a.findIndex(e=>e.id===t.payload.taskId);s>-1&&a.splice(s,1)}).addCase(P.fulfilled,(e,t)=>{e[t.payload.todoListId].unshift(t.payload)}).addCase(F.fulfilled,(e,t)=>{const a=e[t.payload.todolistId],s=a.findIndex(e=>e.id===t.payload.taskId);s>-1&&(a[s]={...a[s],...t.payload.model})})}});var D=a(20),R=a(167),V=a(174),M=a(163),q=a(164);const B=l.a.memo((function(e){let{addItem:t,disabled:a=!1}=e,[s,d]=Object(o.useState)(""),[i,r]=Object(o.useState)(null);const n=async()=>{""!==s.trim()?t(s,{setError:r,setTitle:d}):r("Title is required")};return l.a.createElement("div",null,l.a.createElement(V.a,{variant:"filled",disabled:a,error:!!i,value:s,onChange:e=>{d(e.currentTarget.value)},onKeyPress:e=>{null!==i&&r(null),13===e.charCode&&n()},label:"Title",helperText:i,color:"secondary"}),l.a.createElement(M.a,{color:"secondary",onClick:n,disabled:a,style:{marginLeft:"5px"}},l.a.createElement(q.a,null)))})),J=l.a.memo((function(e){console.log("EditableSpan called");let[t,a]=Object(o.useState)(!1),[s,d]=Object(o.useState)(e.value);return t?l.a.createElement(V.a,{value:s,onChange:e=>{d(e.currentTarget.value)},autoFocus:!0,onBlur:()=>{a(!1),e.onChange(s)}}):l.a.createElement("span",{onDoubleClick:()=>{a(!0),d(e.value)}},e.value)}));var K=a(128),H=a(165),U=a(177);let Y=function(e){return e[e.New=0]="New",e[e.InProgress=1]="InProgress",e[e.Completed=2]="Completed",e[e.Draft=3]="Draft",e}({});var $=a(22);const _=()=>Object(D.b)();function G(e){const t=_();return Object(o.useMemo)(()=>Object($.b)(e,t),[])}const Q=l.a.memo(e=>{const{updateTask:t,removeTask:a}=G(se),s=Object(o.useCallback)(()=>a({taskId:e.task.id,todolistId:e.todolistId}),[e.task.id,e.todolistId]),d=Object(o.useCallback)(a=>{t({taskId:e.task.id,model:{status:a.currentTarget.checked?Y.Completed:Y.New},todolistId:e.todolistId})},[e.task.id,e.todolistId]),i=Object(o.useCallback)(a=>{t({taskId:e.task.id,model:{title:a},todolistId:e.todolistId})},[e.task.id,e.todolistId]);return l.a.createElement("div",{key:e.task.id,className:e.task.status===Y.Completed?"is-done":"",style:{position:"relative"}},l.a.createElement(U.a,{checked:e.task.status===Y.Completed,color:"secondary",onChange:d}),l.a.createElement(J,{value:e.task.title,onChange:i}),l.a.createElement(M.a,{size:"small",onClick:s,style:{position:"absolute",top:"2px",right:"2px"}},l.a.createElement(H.a,{fontSize:"small"})))}),X=l.a.memo((function(e){let{demo:t=!1,...a}=e;const{fetchTasks:s}=G(se),{changeTodolistFilter:d,removeTodolistTC:i,changeTodolistTitleTC:r}=G(ae),n=_();Object(o.useEffect)(()=>{t||s(a.todolist.id)},[]);const c=Object(o.useCallback)(async(e,t)=>{let s=se.addTask({title:e,todolistId:a.todolist.id});const o=await n(s);var l,d;if(se.addTask.rejected.match(o))if(null===(l=o.payload)||void 0===l||null===(d=l.errors)||void 0===d?void 0:d.length){var i;const e=null===(i=o.payload)||void 0===i?void 0:i.errors[0];t.setError(e)}else t.setError("Some error occured");else t.setTitle("")},[a.todolist.id]),p=Object(o.useCallback)(e=>{r({id:a.todolist.id,title:e})},[a.todolist.id]),m=Object(o.useCallback)(e=>d({filter:e,id:a.todolist.id}),[a.todolist.id]);let g=a.tasks;"active"===a.todolist.filter&&(g=a.tasks.filter(e=>e.status===Y.New)),"completed"===a.todolist.filter&&(g=a.tasks.filter(e=>e.status===Y.Completed));const f=(e,t,s)=>l.a.createElement(u.a,{variant:a.todolist.filter===e?"outlined":"text",onClick:()=>m(e),color:t},s);return l.a.createElement(K.a,{style:{padding:"10px",position:"relative"}},l.a.createElement(M.a,{size:"small",onClick:()=>{i(a.todolist.id)},disabled:"loading"===a.todolist.entityStatus,style:{position:"absolute",right:"5px",top:"5px"}},l.a.createElement(H.a,{fontSize:"small"})),l.a.createElement("h3",null,l.a.createElement(J,{value:a.todolist.title,onChange:p})),l.a.createElement(B,{addItem:c,disabled:"loading"===a.todolist.entityStatus}),l.a.createElement("div",null,g.map(e=>l.a.createElement(Q,{key:e.id,task:e,todolistId:a.todolist.id})),!g.length&&l.a.createElement("div",{style:{padding:"10px",color:"grey"}},"No task")),l.a.createElement("div",{style:{paddingTop:"10px"}},f("all","default","All"),f("active","primary","Active"),f("completed","secondary","Completed")))}));var Z=a(14);const ee=e=>e.auth.isLoggedIn,te=e=>{let{demo:t=!1}=e;const a=Object(D.c)(e=>e.todolists),s=Object(D.c)(e=>e.tasks),d=Object(D.c)(ee),i=_(),{fetchTodolistsTC:r,addTodolistTC:n}=G(ae),c=Object(o.useCallback)(async(e,t)=>{let a=ae.addTodolistTC(e);const s=await i(a);var o,l;if(ae.addTodolistTC.rejected.match(s))if(null===(o=s.payload)||void 0===o||null===(l=o.errors)||void 0===l?void 0:l.length){var d;const e=null===(d=s.payload)||void 0===d?void 0:d.errors[0];t.setError(e)}else t.setError("Some error occured");else t.setTitle("")},[]);return Object(o.useEffect)(()=>{!t&&d&&r()},[]),d?l.a.createElement(l.a.Fragment,null,l.a.createElement(R.a,{container:!0,style:{padding:"20px"}},l.a.createElement(B,{addItem:c})),l.a.createElement(R.a,{container:!0,spacing:3,style:{flexWrap:"wrap"}},a.map(e=>{let a=s[e.id];return l.a.createElement(R.a,{item:!0,key:e.id},l.a.createElement("div",{style:{width:"300px"}},l.a.createElement(X,{todolist:e,tasks:a,demo:t})))}))):l.a.createElement(Z.a,{to:"/login"})},ae={...w,...S.actions},se={...N,...W.actions},oe=S.reducer,le=W.reducer;var de=a(178),ie=a(175);function re(e){return l.a.createElement(ie.a,Object.assign({elevation:6,variant:"filled"},e))}function ne(){const e=Object(D.c)(e=>e.app.error),{setAppError:t}=G(b),a=(e,a)=>{"clickaway"!==a&&t({error:null})},s=null!==e;return l.a.createElement(de.a,{open:s,autoHideDuration:6e3,onClose:a},l.a.createElement(re,{onClose:a,severity:"error"},e))}const ce=e=>e.app.status,ue=e=>e.app.isInitialized;var pe=a(179),me=a(162),ge=a(168),fe=a(180),he=a(86);const{setAppStatus:Ee}=b,ye=Object(y.c)("auth/login",async(e,t)=>{t.dispatch(Ee({status:"loading"}));try{const a=await E.login(e);return 0===a.data.resultCode?void t.dispatch(Ee({status:"succeeded"})):k(a.data,t)}catch(a){return v(a,t)}}),be=Object(y.c)("auth/logout",async(e,t)=>{t.dispatch(Ee({status:"loading"}));try{const e=await E.logout();return 0===e.data.resultCode?void t.dispatch(Ee({status:"succeeded"})):k(e.data,t)}catch(a){return v(a,t)}}),ke={login:ye,logout:be},ve=Object(y.d)({name:"auth",initialState:{isLoggedIn:!1},reducers:{setIsLoggedIn(e,t){e.isLoggedIn=t.payload.value}},extraReducers:e=>{e.addCase(ye.fulfilled,e=>{e.isLoggedIn=!0}).addCase(be.fulfilled,e=>{e.isLoggedIn=!1})}}),{setIsLoggedIn:Te}=(ve.reducer,ve.actions),Ce=()=>{const e=_(),t=Object(D.c)(ee),a=Object(he.a)({validate:e=>e.email?e.password?void 0:{password:"Password is required"}:{email:"Email is required"},initialValues:{email:"",password:"",rememberMe:!1},onSubmit:async(t,a)=>{const s=await e(Ie.login(t));var o,l;if(ye.rejected.match(s)&&(null===(o=s.payload)||void 0===o||null===(l=o.fieldsErrors)||void 0===l?void 0:l.length)){var d;const e=null===(d=s.payload)||void 0===d?void 0:d.fieldsErrors[0];a.setFieldError(e.field,e.error)}}});return t?l.a.createElement(Z.a,{to:"/"}):l.a.createElement(R.a,{container:!0,justify:"center"},l.a.createElement(R.a,{item:!0,xs:4},l.a.createElement("form",{onSubmit:a.handleSubmit},l.a.createElement(pe.a,null,l.a.createElement(me.a,null,l.a.createElement("p",null,"To log in get registered ",l.a.createElement("a",{href:"https://social-network.samuraijs.com/",target:"_blank"},"here")),l.a.createElement("p",null,"or use common test account credentials:"),l.a.createElement("p",null," Email: free@samuraijs.com"),l.a.createElement("p",null,"Password: free")),l.a.createElement(ge.a,null,l.a.createElement(V.a,Object.assign({label:"Email",margin:"normal",color:"secondary",error:!!a.errors.email,helperText:a.errors.email},a.getFieldProps("email"))),l.a.createElement(V.a,Object.assign({type:"password",label:"Password",margin:"normal",color:"secondary",error:!!a.errors.password,helperText:a.errors.password},a.getFieldProps("password"))),l.a.createElement(fe.a,{label:"Remember me",control:l.a.createElement(U.a,Object.assign({},a.getFieldProps("rememberMe"),{checked:a.values.rememberMe}))}),l.a.createElement(u.a,{type:"submit",variant:"contained",color:"secondary"},"Login"))))))},Ie={...ke,...ve.actions},je=ve.reducer,Oe=Object(y.c)("application/initializeApp",async(e,t)=>{let{dispatch:a}=t;0===(await E.me()).data.resultCode&&a(Ie.setIsLoggedIn({value:!0}))}),we={initializeApp:Oe},Se=Object(y.d)({name:"app",initialState:{status:"idle",error:null,isInitialized:!1},reducers:{},extraReducers:e=>{e.addCase(Oe.fulfilled,(e,t)=>{e.isInitialized=!0}).addCase(b.setAppStatus,(e,t)=>{e.status=t.payload.status}).addCase(b.setAppError,(e,t)=>{e.error=t.payload.error})}}),xe=Se.reducer,Ae={...Se.actions,...we};var Le=function(e){let{demo:t=!1}=e;const a=Object(D.c)(ce),d=Object(D.c)(ue),i=Object(D.c)(s.selectIsLoggedIn),{logout:g}=G(Ie),{initializeApp:f}=G(Ae);Object(o.useEffect)(()=>{t||f()},[]);const h=Object(o.useCallback)(()=>{g()},[]);return d?l.a.createElement("div",{className:"App"},l.a.createElement(ne,null),l.a.createElement(n.a,{position:"static",color:"inherit"},l.a.createElement(c.a,null,l.a.createElement("div",{className:"title"},"TodoList"),i&&l.a.createElement(u.a,{color:"secondary",variant:"outlined",onClick:h},"Log out")),"loading"===a&&l.a.createElement(p.a,{color:"secondary"})),l.a.createElement(m.a,{fixed:!0},l.a.createElement(Z.b,{exact:!0,path:"/",render:()=>l.a.createElement(te,{demo:t})}),l.a.createElement(Z.b,{path:"/login",render:()=>l.a.createElement(Ce,null)}))):l.a.createElement("div",{style:{position:"fixed",top:"30%",textAlign:"center",width:"100%"}},l.a.createElement(r.a,null))},ze=a(46);const Pe=Object($.c)({app:xe,auth:je,todolists:oe,tasks:le}),Fe=Object(y.a)({reducer:Pe,middleware:e=>e().prepend(ze.a)});window.store=Fe;var Ne=a(45);i.a.render(l.a.createElement(D.a,{store:Fe},l.a.createElement(Ne.a,null,l.a.createElement(Le,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})},98:function(e,t,a){e.exports=a(127)}},[[98,1,2]]]);
//# sourceMappingURL=main.6bc240ee.chunk.js.map